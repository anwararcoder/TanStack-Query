# What is TanStack Query and how to use it with React.Js & Next.Js From the scratch?
TanStack Query, formerly known as React Query, is frequently characterized as the data-fetching library that web applications have been lacking. To delve into more technical details, it simplifies the processes of fetching, caching, synchronizing, and updating the server state in your web applications.

## Installation With React Js
Make sure you have TanStack Query installed in your project. You can typically install it using a package manager like npm or yarn
```bash
i @tanstack/react-query
i @tanstack/react-query-devtools
npm i axios
```

## Setup
Import QueryClientProvider and QueryClient from TanStack Query and wrap your application with QueryClientProvider. Create an instance of QueryClient and pass it as the client prop
```javascript
import { QueryClient, QueryClientProvider } from 'react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'

const queryClient = new QueryClient();

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <App />
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}
```

## Fetching Data
Use the useQuery hook to fetch data. Provide a unique key for the query and a function that fetches the data
```javascript
import { useQuery } from 'react-query';
import axios from "axios";

function App() {
  // Access the client
  const queryClient = useQueryClient()

  const getAllPosts = () => {
    return axios.get("https://jsonplaceholder.typicode.com/posts");
  }

  // Queries
  const { data, isLoading, isError } = useQuery({ queryKey: ['posts'], queryFn: getAllPosts })

  if (isLoading) {
    return <p>Loading...</p>;
  }

  if (isError) {
    return <p>Error fetching data</p>;
  }

  // Render your component with the fetched data
  return (
    <div>
      <ul>{data?.map((post) => <li key={post.id}>{post.title}</li>)}</ul>
      <button>Add Post</button>
    </div>
  )
}
```

## Mutating Data
Use the useMutation hook to perform mutations (updating, creating, or deleting data)
```javascript
import { useMutation } from 'react-query';

function App() {
  const addPost = (post) => {
    return axios.post("https://jsonplaceholder.typicode.com/posts", post);
  }

  // Mutations
  const mutation = useMutation({
    mutationFn: addPost,
    onSuccess: () => {
      // Invalidate and refetch
      queryClient.invalidateQueries({ queryKey: ['posts'] })
    },
  })

  // Trigger the mutation when needed
  const handleAddPost = () => {
    mutation.mutate({
      id: Date.now(),
      title: 'Do Laundry',
    })
  };

  return (
    <div>
      <ul>{data?.map((post) => <li key={post.id}>{post.title}</li>)}</ul>
      <button onClick={handleAddPost}>Add Post</button>
    </div>
  )
}
```


## Installation With Next Js


### STEP 1: Make a Custom Provider
NEXT JS Configuration (Custom Provider)

```javascript
"use client";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";
import { useState } from "react";

export default function CustomReactQueryProvider({ children }) {
  const [queryClient] = useState(() => new QueryClient());
  return (
    <QueryClientProvider client={queryClient}>
      {children}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}
```

### STEP 2: Set up in our application

```javascript
import "./globals.css";
import AppLayout from "@/Components/AppLayout/AppLayout";
import CustomReactQueryProvider from "@/ReactQuery/CustomReactQueryProvider";

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <CustomReactQueryProvider>
          <AppLayout children={children} />
        </CustomReactQueryProvider>
      </body>
    </html>
  );
}
```

### STEP 3: In AppLayout Component

```javascript
"use client";
import React, { Fragment } from "react";

const AppLayout = ({ children }) => {
  return (
    <Fragment>{children}</Fragment>
  );
};

export default AppLayout;
```

### STEP 4: Fetching Data In Home Page Component

```javascript
const Home = () => {
  const getAllPosts = () => {
    return axios.get("https://jsonplaceholder.typicode.com/posts");
  }

  // Queries
  const { data, isLoading, isError } = useQuery({ queryKey: ["posts"], queryFn: getAllPosts });

  if (isLoading) {
    return <p>Loading...</p>;
  }

  if (isError) {
    return <p>Error fetching data</p>;
  }

  // Render your component with the fetched data
  return (
    <div>
      <ul>{data?.map((post) => <li key={post.id}>{post.title}</li>)}</ul>
      <button>Add Post</button>
    </div>
  )
}
```

### STEP 5: Mutating Data
Use the useMutation hook to perform mutations (updating, creating, or deleting data)
```javascript
import { useMutation } from 'react-query';

function Home() {
  const getAllPosts = () => {
    return axios.get("https://jsonplaceholder.typicode.com/posts");
  }

  // Queries
  const { data, isLoading, isError } = useQuery({ queryKey: ["posts"], queryFn: getAllPosts });

  if (isLoading) {
    return <p>Loading...</p>;
  }

  if (isError) {
    return <p>Error fetching data</p>;
  }
  const addPost = (post) => {
    return axios.post("https://jsonplaceholder.typicode.com/posts", post);
  }

  // Mutations
  const [queryClient] = useState(() => new QueryClient());
  const useAddPostMutation = () => {
    return useMutation({
      mutationFn: addPost,
      onSuccess: () => {
        queryClient.invalidateQueries({ queryKey: ["posts"] });
      },
    });
  };
  const { mutateAsync } = useAddPostMutation();
  

  // Trigger the mutation when needed
  const handleAddPost = () => {
    try {
      const response = await mutateAsync({ id: Date.now(), title: 'Do Laundry', });
      return response;
    } catch (error) {
      console.log(error.message)
    }
  };

  return (
    <div>
      <ul>{data?.map((post) => <li key={post.id}>{post.title}</li>)}</ul>
      <button onClick={handleAddPost}>Add Post</button>
    </div>
  )
}
```

## By Following the above listed steps , Userâ€™s can understand the React Query Integration in NEXT JS and React JS From the scratch.
